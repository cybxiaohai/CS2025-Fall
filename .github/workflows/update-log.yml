# .github/workflows/update-log.yml
name: Update Learning Log

on:
  schedule:
    - cron: '0 0 * * 1'  # æ¯å‘¨ä¸€ 00:00 UTCï¼ˆåŒ—äº¬æ—¶é—´ å‘¨ä¸€ 8:00ï¼‰
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-log:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository #æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          # å…è®¸æäº¤å˜æ›´
          token: ${{ secrets.ACCESS_TOKEN }}

      #æ·»åŠ ä¸€è¡Œæ–°æ—¥å¿—ï¼Œæ—¶é—´æ ¼å¼ä¸ºYYYY-MM-DD HH:MM 
      - name: Generate new log entry #ç”Ÿæˆæ—¥å¿—æ¡ç›®
        run: | 
          echo "## $(date '+%Y-%m-%d')" >> docs/å­¦ä¹ æ—¥å¿—.md
          echo "- $(date '+%Y-%m-%d %H:%M'): æœ¬å‘¨å­¦ä¹ ç»§ç»­ä¸­..." >> docs/å­¦ä¹ æ—¥å¿—.md
          echo "" >> docs/å­¦ä¹ æ—¥å¿—.md
      

      - name: Commit and push changes #æäº¤æ›´æ”¹
        run: |
          git config --global user.name "cybxiaohai"
          git config --global user.email "icec41311@gmail.com"
          git add docs/å­¦ä¹ æ—¥å¿—.md
          # æäº¤ï¼ˆé¿å…ç©ºæäº¤ï¼‰
          if git diff-index --quiet HEAD -- ; then
            echo "æ²¡æœ‰å˜æ›´ï¼Œè·³è¿‡æäº¤"
          else
            git commit -m "ğŸ“ è‡ªåŠ¨æ›´æ–°å­¦ä¹ æ—¥å¿— $(date '+%Y-%m-%d')"
            git push "https://cybxiaohai:${{ secrets.ACCESS_TOKEN }}@github.com/cybxiaohai/CS2025-Fall.git" HEAD:main
          fi
          